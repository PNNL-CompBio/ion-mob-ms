FROM ubuntu:18.04

# Install wget
RUN apt-get update
RUN apt-get install -y wget

# Add 32-bit architecture
RUN dpkg --add-architecture i386
RUN apt-get update

# Install Wine
RUN apt-get install -y software-properties-common gnupg2
RUN wget -nc https://dl.winehq.org/wine-builds/winehq.key
RUN apt-key add winehq.key
RUN apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'
RUN apt-get install -y --install-recommends winehq-stable winbind

# Turn off Fixme warnings
ENV WINEDEBUG=fixme-all

# Setup a Wine prefix
ENV WINEPREFIX=/root/.net
ENV WINEARCH=win64
RUN winecfg

# Install Winetricks
RUN apt-get install -y cabextract
RUN wget https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks
RUN chmod +x winetricks
RUN cp winetricks /usr/local/bin

# Install .NET Framework 4.5.2
RUN wineboot -u && winetricks -q dotnet452
# Install Mono
RUN wget -P /mono http://dl.winehq.org/wine/wine-mono/4.9.4/wine-mono-4.9.4.msi
RUN wineboot -u && msiexec /i /mono/wine-mono-4.9.4.msi
RUN rm -rf /mono/wine-mono-4.9.4.msi

RUN apt-get update \
    && apt-get install \
    --no-install-recommends \
    --yes  \
    wget \
    && apt-get clean

RUN wget -P /pnnl_preprocessor/ https://panomics.pnnl.gov/downloads/installers/PNNL-Preprocessor_4.0_2022.02.17_INSTALLER.exe

#clean unnecessary packages
RUN apt-get -y remove \
    wget \
    &&  apt-get -y autoremove && apt-get clean

# Run
ENTRYPOINT ["wine", "/pnnl_preprocessor/PNNL-Preprocessor_4.0_2022.02.17_INSTALLER.exe"]

